!function e(t,r,i){function o(n,s){if(!r[n]){if(!t[n]){var h="function"==typeof require&&require;if(!s&&h)return h(n,!0);if(a)return a(n,!0);var p=new Error("Cannot find module '"+n+"'");throw p.code="MODULE_NOT_FOUND",p}var c=r[n]={exports:{}};t[n][0].call(c.exports,function(e){var r=t[n][1][e];return o(r?r:e)},c,c.exports,e,t,r,i)}return r[n].exports}for(var a="function"==typeof require&&require,n=0;n<i.length;n++)o(i[n]);return o}({1:[function(e,t,r){function i(e){this.renderer=e,this.tileAnim=[0,0]}PIXI.CanvasRenderer.registerPlugin("tile",i),t.exports=i},{}],2:[function(e,t,r){function i(){PIXI.Container.apply(this,arguments),this.initialize.apply(this,arguments)}var o=e("./RectTileLayer");i.prototype=Object.create(PIXI.Container.prototype),i.prototype.constructor=o,i.prototype.updateTransform=i.prototype.displayObjectUpdateTransform,i.prototype.initialize=function(e,t,r){this.z=this.zIndex=e,this.useSquare=r,t&&this.setBitmaps(t)},i.prototype.setBitmaps=function(e){this.removeChildren();for(var t=0;t<e.length;t++)this.addChild(new o(this.zIndex,e[t]));this.modificationMarker=0},i.prototype.clear=function(){for(var e=0;e<this.children.length;e++)this.children[e].clear();this.modificationMarker=0},i.prototype.addRect=function(e,t,r,i,o,a,n){this.children[e]&&this.children[e].texture&&this.children[e].addRect(t,r,i,o,a,n)},i.prototype.addFrame=function(e,t,r){"string"==typeof e&&(e=PIXI.Texture.fromImage(e));for(var i=this.children,a=null,n=0;n<i.length;n++)if(i[n].texture.baseTexture==e.baseTexture){a=i[n];break}return a||i.push(a=new o(this.zIndex,e)),a.addRect(e.frame.x,e.frame.y,t,r,e.frame.width,e.frame.height),!0},i.prototype.renderCanvas=function(e){if(!e.dontUseTransform){var t=this.worldTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution)}for(var r=this.children,i=0;i<r.length;i++)r[i].renderCanvas(e)},i.prototype.renderWebGL=function(e){var t=(e.gl,e.plugins.tile.getShader(this.useSquare));if(e.setObjectRenderer(e.plugins.tile),e.bindShader(t),this._globalMat=this._globalMat||new PIXI.Matrix,e._activeRenderTarget.projectionMatrix.copy(this._globalMat).append(this.worldTransform),t.uniforms.projectionMatrix=this._globalMat.toArray(!0),this.useSquare){var r=this._tempScale=this._tempScale||[0,0];r[0]=this._globalMat.a>=0?1:-1,r[1]=this._globalMat.d<0?1:-1;t.uniforms.pointScale=r;t.uniforms.projectionScale=Math.abs(this.worldTransform.a)*e.resolution}for(var i=(t.uniforms.animationFrame=e.plugins.tile.tileAnim,this.children),o=0;o<i.length;o++)i[o].renderWebGL(e,this.useSquare)},i.prototype.isModified=function(e){var t=this.children;if(this.modificationMarker!=t.length)return!0;for(var r=0;r<t.length;r++)if(t[r].modificationMarker!=t[r].pointsBuf.length||e&&t[r].hasAnim)return!0;return!1},i.prototype.clearModify=function(){var e=this.children;this.modificationMarker=e.length;for(var t=0;t<e.length;t++)e[t].modificationMarker=e[t].pointsBuf.length},t.exports=i},{"./RectTileLayer":4}],3:[function(e,t,r){function i(e){PIXI.Graphics.apply(this,arguments),this.z=this.zIndex=e}i.prototype=Object.create(PIXI.Graphics.prototype),i.prototype.constructor=i,i.prototype.renderCanvas=function(e){var t=null;e.dontUseTransform&&(t=this.transform.worldTransform,this.transform.worldTransform=PIXI.Matrix.IDENTITY),e.plugins.graphics.render(this),e.dontUseTransform&&(this.transform.worldTransform=t),e.context.globalAlpha=1},i.prototype.renderWebGL=function(e){this._webGL[e.gl.id]||(this.dirty=!0),PIXI.Graphics.prototype.renderWebGL.call(this,e)},i.prototype.isModified=function(e){return!1},i.prototype.clearModify=function(){},t.exports=i},{}],4:[function(e,t,r){function i(e,t){PIXI.DisplayObject.apply(this,arguments),this.initialize.apply(this,arguments)}i.prototype=Object.create(PIXI.DisplayObject.prototype),i.prototype.constructor=i,i.prototype.initialize=function(e,t){this.texture=t,this.z=this.zIndex=e,this.pointsBuf=[],this.visible=!1},i.prototype.clear=function(){this.pointsBuf.length=0,this.modificationMarker=0,this.hasAnim=!1},i.prototype.renderCanvas=function(e){if(this.texture&&this.texture.valid)for(var t=this.pointsBuf,r=0,i=t.length;i>r;r+=8){var o=t[r],a=t[r+1],n=t[r+2],s=t[r+3],h=t[r+4],p=t[r+5];o+=t[r+6]*e.plugins.tile.tileAnim[0],a+=t[r+7]*e.plugins.tile.tileAnim[1],e.context.drawImage(this.texture.baseTexture.source,o,a,h,p,n,s,h,p)}},i.prototype.addRect=function(e,t,r,i,o,a,n,s){var h=this.pointsBuf;if(this.hasAnim=this.hasAnim||n>0||s>0,o==a)h.push(e),h.push(t),h.push(r),h.push(i),h.push(o),h.push(a),h.push(0|n),h.push(0|s);else if(o%a===0)for(var p=0;o/a>p;p++)h.push(e+p*a),h.push(t),h.push(r+p*a),h.push(i),h.push(a),h.push(a),h.push(0|n),h.push(0|s);else h.push(e),h.push(t),h.push(r),h.push(i),h.push(o),h.push(a),h.push(0|n),h.push(0|s)},i.prototype.renderWebGL=function(e,t){if(this.texture&&this.texture.valid){var r=this.pointsBuf;if(0!==r.length){var i=e.plugins.tile,o=e.gl,a=i.getShader(t),n=this.texture.baseTexture;e.bindTexture(n,0);var s=this._tempSize=this._tempSize||[0,0];s[0]=1/n.width,s[1]=1/n.height,a.uniforms.samplerSize=s;var h=i.getVb(this.vbId);h||(h=i.createVb(t),this.vbId=h.id,this.vbBuffer=null,this.modificationMarker=0);h.vao.bind();h=h.vb,h.bind();var p=r.length/8*a.vertPerQuad;if(this.modificationMarker!=p){this.modificationMarker=p;var c=a.stride*p;if(!this.vbBuffer||this.vbBuffer.byteLength<c){for(var l=a.stride;c>l;)l*=2;this.vbBuffer=new ArrayBuffer(l),this.vbArray=new Float32Array(this.vbBuffer),this.vbInts=new Uint32Array(this.vbBuffer),h.upload(this.vbBuffer,0,!0)}var u,d=this.vbArray,f=(this.vbInts,0);if(t)for(u=0;u<r.length;u+=8)d[f++]=r[u+2],d[f++]=r[u+3],d[f++]=r[u+0],d[f++]=r[u+1],d[f++]=r[u+4],d[f++]=r[u+6],d[f++]=r[u+7];else{n.width,n.height;for(u=0;u<r.length;u+=8){var v=r[u+2],m=r[u+3],y=r[u+4],g=r[u+5],x=r[u],b=r[u+1],I=r[u+6],S=r[u+7];d[f++]=v,d[f++]=m,d[f++]=x,d[f++]=b,d[f++]=I,d[f++]=S,d[f++]=v+y,d[f++]=m,d[f++]=x+y,d[f++]=b,d[f++]=I,d[f++]=S,d[f++]=v+y,d[f++]=m+g,d[f++]=x+y,d[f++]=b+g,d[f++]=I,d[f++]=S,d[f++]=v,d[f++]=m,d[f++]=x,d[f++]=b,d[f++]=I,d[f++]=S,d[f++]=v+y,d[f++]=m+g,d[f++]=x+y,d[f++]=b+g,d[f++]=I,d[f++]=S,d[f++]=v,d[f++]=m+g,d[f++]=x,d[f++]=b+g,d[f++]=I,d[f++]=S}}h.upload(d,0,!0)}t?o.drawArrays(o.POINTS,0,p):o.drawArrays(o.TRIANGLES,0,p)}}},t.exports=i},{}],5:[function(e,t,r){function i(e){PIXI.Shader.call(this,e,["precision lowp float;","attribute vec4 aVertexPosition;","attribute vec2 aAnim;","uniform mat3 projectionMatrix;","uniform vec2 samplerSize;","uniform vec2 animationFrame;","varying vec2 vTextureCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition.xy, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = (aVertexPosition.zw + aAnim * animationFrame ) * samplerSize;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord);","}"].join("\n")),this.vertSize=6,this.vertPerQuad=6,this.stride=4*this.vertSize}i.prototype=Object.create(PIXI.Shader.prototype),i.prototype.constructor=i,i.prototype.createVao=function(e,t){var r=e.gl;return e.createVao().addIndex(this.indexBuffer).addAttribute(t,this.attributes.aVertexPosition,r.FLOAT,!1,this.stride,0).addAttribute(t,this.attributes.aAnim,r.FLOAT,!1,this.stride,16)},t.exports=i},{}],6:[function(e,t,r){function i(e){PIXI.Shader.call(this,e,["attribute vec4 aVertexPosition;","attribute vec3 aSize;","uniform mat3 projectionMatrix;","uniform vec2 samplerSize;","uniform vec2 animationFrame;","uniform float projectionScale;","varying vec2 vTextureCoord;","varying float vSize;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition.xy + aSize.x * 0.5, 1.0)).xy, 0.0, 1.0);","   gl_PointSize = aSize.x * projectionScale;","   vTextureCoord = (aVertexPosition.zw + aSize.yz * animationFrame ) * samplerSize;","   vSize = aSize.x;","}"].join("\n"),["varying vec2 vTextureCoord;","varying float vSize;","uniform vec2 samplerSize;","uniform sampler2D uSampler;","uniform vec2 pointScale;","void main(void){","   float margin = 0.5/vSize;","   vec2 clamped = vec2(clamp(gl_PointCoord.x, margin, 1.0 - margin), clamp(gl_PointCoord.y, margin, 1.0 - margin));","   gl_FragColor = texture2D(uSampler, ((clamped-0.5) * pointScale + 0.5) * vSize * samplerSize + vTextureCoord);","}"].join("\n")),this.vertSize=7,this.vertPerQuad=1,this.stride=4*this.vertSize}i.prototype=Object.create(PIXI.Shader.prototype),i.prototype.constructor=i,i.prototype.createVao=function(e,t){var r=e.gl;return e.createVao().addIndex(this.indexBuffer).addAttribute(t,this.attributes.aVertexPosition,r.FLOAT,!1,this.stride,0).addAttribute(t,this.attributes.aSize,r.FLOAT,!1,this.stride,16)},t.exports=i},{}],7:[function(e,t,r){function i(e){PIXI.ObjectRenderer.call(this,e),this.vbs={},this.lastTimeCheck=0,this.tileAnim=[0,0],this.indices=new Uint16Array([0,1,2,0,2,3])}var o=e("./RectTileShader"),a=e("./SquareTileShader");i.prototype=Object.create(PIXI.ObjectRenderer.prototype),i.prototype.constructor=i,i.vbAutoincrement=0,i.prototype.onContextChange=function(){var e=this.renderer.gl;this.rectShader=new o(e),this.squareShader=new a(e),this.indexBuffer=PIXI.glCore.GLBuffer.createIndexBuffer(e,this.indices,e.STATIC_DRAW),this.rectShader.indexBuffer=this.indexBuffer,this.squareShader.indexBuffer=this.indexBuffer,this.vbs={}},i.prototype.checkLeaks=function(){var e=Date.now(),t=e-1e4;if(this.lastTimeCheck<t||this.lastTimeCheck>e){this.lastTimeCheck=e;var r=this.vbs;for(var i in r)r[i].lastTimeAccess<t&&this.removeVb(i)}},i.prototype.start=function(){this.renderer.state.setBlendMode(PIXI.BLEND_MODES.NORMAL)},i.prototype.getVb=function(e){this.checkLeaks();var t=this.vbs[e];return t?(t.lastAccessTime=Date.now(),t):null},i.prototype.createVb=function(e){var t=++i.vbAutoincrement,r=this.getShader(e),o=this.renderer.gl,a=PIXI.glCore.GLBuffer.createVertexBuffer(o,null,o.STREAM_DRAW),n={id:t,vb:a,vao:r.createVao(this.renderer,a),lastTimeAccess:Date.now(),useSquare:e,shader:r};return this.vbs[t]=n,n},i.prototype.removeVb=function(e){this.vbs[e]&&(this.vbs[e].vb.destroy(),this.vbs[e].vao.destroy(),delete this.vbs[e])},i.prototype.getShader=function(e){return e?this.squareShader:this.rectShader},i.prototype.destroy=function(){PIXI.ObjectRenderer.prototype.destroy.call(this),this.rectShader.destroy(),this.squareShader.destroy(),this.rectShader=null,this.squareShader=null},PIXI.WebGLRenderer.registerPlugin("tile",i),t.exports=i},{"./RectTileShader":5,"./SquareTileShader":6}],8:[function(e,t,r){function i(){this.initialize.apply(this,arguments)}i.prototype=Object.create(PIXI.Container.prototype),i.prototype.initialize=function(e,t){PIXI.Container.apply(this,arguments),this.tilemap=e,this.z=t},i.prototype.clear=function(){for(var e=this.children,t=0;t<e.length;t++)e[t].clear();this._previousLayers=0},i.prototype.cacheIfDirty=function(){var e=this.tilemap,t=this.children,r=this._previousLayers!=t.length;this._previousLayers=t.length;var i=this.canvasBuffer,o=this._tempRender;i||(i=this.canvasBuffer=document.createElement("canvas"),o=this._tempRender=new PIXI.CanvasRenderer(100,100,{view:i}),o.context=o.rootContext,o.dontUseTransform=!0),i.width==e._layerWidth&&i.height==e._layerHeight||(i.width=e._layerWidth,i.height=e._layerHeight,r=!0);var a;if(!r)for(a=0;a<t.length;a++)if(t[a].isModified(this._lastAnimationFrame!=e.animationFrame)){r=!0;break}if(this._lastAnimationFrame=e.animationFrame,r)for(e._hackRenderer&&e._hackRenderer(o),o.context.clearRect(0,0,i.width,i.height),a=0;a<t.length;a++)t[a].clearModify(),t[a].renderCanvas(o);for(this.layerTransform=this.worldTransform,a=0;a<t.length;a++){this.layerTransform=t[a].worldTransform;break}},i.prototype.renderCanvas=function(e){this.cacheIfDirty();var t=this.layerTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution);this.tilemap;e.context.drawImage(this.canvasBuffer,0,0)},t.exports=i},{}],9:[function(e,t,r){PIXI.tilemap={ZLayer:e("./ZLayer"),GraphicsLayer:e("./GraphicsLayer"),RectTileLayer:e("./RectTileLayer"),CompositeRectTileLayer:e("./CompositeRectTileLayer"),CanvasTileRenderer:e("./CanvasTileRenderer"),TileRenderer:e("./TileRenderer")},t.exports=PIXI.tilemap},{"./CanvasTileRenderer":1,"./CompositeRectTileLayer":2,"./GraphicsLayer":3,"./RectTileLayer":4,"./TileRenderer":7,"./ZLayer":8}]},{},[9]);
//# sourceMappingURL=pixi-tilemap.min.js.map
